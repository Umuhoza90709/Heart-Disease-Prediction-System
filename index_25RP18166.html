<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heart Disease Risk Prediction</title>
<style>
/* ---------- General ---------- */
body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
}
.container {
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
}

/* ---------- Form ---------- */
form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px 20px;
    background: #e3f6f5;
    padding: 20px;
    border-radius: 10px;
}
form label {
    font-weight: bold;
    margin-bottom: 5px;
    display: block;
}
form input, form select {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
form button {
    grid-column: 1 / -1;
    background: #0984e3;
    color: #fff;
    border: none;
    padding: 12px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
}
form button:hover {
    background: #74b9ff;
}

/* ---------- Results ---------- */
.results {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}
#resultText {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 15px;
}
.badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
}

/* Risk level colors */
.no-risk { background: #28a745; }
.very-mild { background: #90ee90; color:#000; }
.mild { background: #ffc107; color:#000; }
.severe { background: #fd7e14; }
.immediate { background: #dc3545; }

/* Probabilities bars */
.probability-bar {
    margin-bottom: 10px;
}
.progress-container {
    background: #eee;
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    text-align: right;
    padding-right: 5px;
    font-weight: bold;
    color: white;
    border-radius: 10px;
}

/* ---------- Responsive ---------- */
@media screen and (max-width: 700px) {
    form {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>

<div class="container">
    <h2>Heart Disease Risk Prediction</h2>

    <form id="predictionForm">
        <label>Age</label>
        <input name="age" type="number" placeholder="Age" required>

        <label>Sex</label>
        <select name="sex"><option>Male</option><option>Female</option></select>

        <label>Chest Pain Type</label>
        <select name="cp">
            <option>Typical Angina</option>
            <option>Atypical Angina</option>
            <option>Non-Anginal Pain</option>
            <option>Asymptomatic</option>
        </select>

        <label>Resting BP</label>
        <input name="trestbps" type="number" placeholder="Resting BP" required>

        <label>Cholesterol</label>
        <input name="chol" type="number" placeholder="Cholesterol" required>

        <label>Fasting Blood Sugar >120 mg/dl</label>
        <select name="fbs"><option value="TRUE">Yes</option><option value="FALSE">No</option></select>

        <label>Resting ECG</label>
        <select name="restecg"><option>Normal</option><option>ST-T abnormality</option><option>LV hypertrophy</option></select>

        <label>Max Heart Rate Achieved</label>
        <input name="thalach" type="number" placeholder="Max HR" required>

        <label>Exercise Induced Angina</label>
        <select name="exang"><option>Yes</option><option>No</option></select>

        <label>ST Depression (Oldpeak)</label>
        <input name="oldpeak" type="number" step="0.1" placeholder="Oldpeak" required>

        <label>ST Slope</label>
        <select name="slope"><option>Upsloping</option><option>Flat</option><option>Downsloping</option></select>

        <label>Number of Major Vessels</label>
        <input name="ca" type="number" min="0" max="4" placeholder="CA" required>

        <label>Thalassemia</label>
        <select name="thal"><option>Normal</option><option>Fixed Defect</option><option>Reversible Defect</option></select>

        <button type="submit">Predict</button>
    </form>

    <div class="results">
        <div id="resultText"></div>
        <div id="probs"></div>
    </div>
</div>

<script>
document.getElementById('predictionForm').onsubmit = async e => {
    e.preventDefault();

    const data = Object.fromEntries(new FormData(e.target));
    ['age','trestbps','chol','thalach','oldpeak','ca'].forEach(k => data[k] = parseFloat(data[k]));

    document.getElementById('resultText').innerText = 'Analyzing...';
    document.getElementById('probs').innerHTML = '';

    const res = await fetch('/api/predict',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
    });

    const result = await res.json();

    const p = result.prediction;

    // Map risk level to badge class
    const riskClass = {
        "No Risk": "no-risk",
        "Very Mild Risk": "very-mild",
        "Mild Risk": "mild",
        "Severe Risk": "severe",
        "Immediate Danger": "immediate"
    }[p.risk_level] || "no-risk";

    document.getElementById('resultText').innerHTML = `
        <b>${p.class_name}</b> 
        <span class="badge ${riskClass}">${p.risk_level}</span><br>
        Confidence: ${p.confidence}%
    `;

    // Display probability bars
    let html = '';
    result.probabilities.forEach(x => {
        const colorClass = {
            "No Risk": "#28a745",
            "Very Mild Risk": "#90ee90",
            "Mild Risk": "#ffc107",
            "Severe Risk": "#fd7e14",
            "Immediate Danger": "#dc3545"
        }[x.class_name] || "#6c757d";

        html += `
            <div class="probability-bar">
                ${x.class_name}: ${x.probability}%
                <div class="progress-container">
                    <div class="progress-fill" style="width:${x.probability}%; background:${colorClass};">
                        ${x.probability}%
                    </div>
                </div>
            </div>
        `;
    });
    document.getElementById('probs').innerHTML = html;
};
</script>

</body>
</html>
